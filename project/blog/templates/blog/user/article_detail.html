{% extends 'main/base.html' %}
{% load static %}
{% load blog_extras %}

{% block title %}{{ page_title }}{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/global_forms.css' %}">
<link rel="stylesheet" href="{% static 'css/blog.css' %}">
<meta name="description" content="{{ page_description }}">
<meta name="keywords" content="{{ page_keywords }}">
<meta name="author" content="{{ author_name }}">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="article">
<meta property="og:url" content="{{ request.build_absolute_uri }}">
<meta property="og:title" content="{{ page_title }}">
<meta property="og:description" content="{{ page_description }}">
{% if post.thumbnail %}
<meta property="og:image" content="{{ request.scheme }}://{{ request.get_host }}{{ post.thumbnail.url }}">
{% else %}
<meta property="og:image" content="{% static 'images/logo-graff.png' %}">
{% endif %}
<meta property="og:site_name" content="Reefel Workshop">
<meta property="article:author" content="{{ author_name }}">
<meta property="article:published_time" content="{{ post.created_at|date:'c' }}">
<meta property="article:modified_time" content="{{ post.updated_at|date:'c' }}">
{% for category in post.categories.all %}
<meta property="article:section" content="{{ category.name }}">
{% endfor %}

<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:url" content="{{ request.build_absolute_uri }}">
<meta property="twitter:title" content="{{ page_title }}">
<meta property="twitter:description" content="{{ page_description }}">
{% if post.thumbnail %}
<meta property="twitter:image" content="{{ request.scheme }}://{{ request.get_host }}{{ post.thumbnail.url }}">
{% else %}
<meta property="twitter:image" content="{% static 'images/logo-graff.png' %}">
{% endif %}

<!-- Canonical URL -->
<link rel="canonical" href="{{ request.build_absolute_uri }}">

<!-- JSON-LD Structured Data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "{{ post.title }}",
  "description": "{{ page_description }}",
  "image": "{% if post.thumbnail %}{{ request.scheme }}://{{ request.get_host }}{{ post.thumbnail.url }}{% else %}{% static 'images/logo-graff.png' %}{% endif %}",
  "author": {
    "@type": "Person",
    "name": "{{ author_name }}"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Reefel Workshop",
    "url": "{{ request.scheme }}://{{ request.get_host }}"
  },
  "datePublished": "{{ post.created_at|date:'c' }}",
  "dateModified": "{{ post.updated_at|date:'c' }}",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ request.build_absolute_uri }}"
  }
}
</script>
{% endblock %}

{% block content %}
<!-- HERO SECTION -->
<section class="flex-1 flex justify-center bg-slate-900 py-16 relative min-h-[50vh] px-3 max-w-screen overflow-hidden">
    <!-- Background Pattern -->
    <div class="absolute inset-0 opacity-10">
        <div class="absolute top-20 left-10 w-32 h-32 bg-orange-500 rounded-full blur-3xl"></div>
        <div class="absolute bottom-20 right-10 w-40 h-40 bg-cyan-500 rounded-full blur-3xl"></div>
    </div>
    
    <!-- Container -->
    <div class="flex flex-col w-full max-w-4xl justify-center items-center min-h-96 relative z-20">
        
        <!-- Breadcrumb -->
        <nav class="flex items-center space-x-2 text-slate-300 mb-8 animate-breadcrumb opacity-0">
            <a href="{% url 'main:index' %}" class="hover:text-cyan-400 transition-colors">Accueil</a>
            <i class="fas fa-chevron-right text-xs"></i>
            <a href="{% url 'blog:index' %}" class="hover:text-cyan-400 transition-colors">Blog</a>
            <i class="fas fa-chevron-right text-xs"></i>
            <span class="text-orange-400">Article</span>
        </nav>

        <!-- Categories -->
        {% if post.categories.all %}
            <div class="flex flex-wrap gap-2 mb-6 animate-categories opacity-0">
                {% for category in post.categories.all %}
                    <a href="{% url 'blog:blog_category' category.slug %}" 
                       class="bg-orange-500/20 text-orange-300 px-4 py-2 rounded-full text-sm font-medium border border-orange-500/30 hover:bg-orange-500/30 transition-colors">
                        {{ category.name }}
                    </a>
                {% endfor %}
            </div>
        {% endif %}

        <!-- Title -->
        <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold text-white mb-6 text-center leading-tight animate-title opacity-0">
            {{ post.title }}
        </h1>
        
        <!-- Meta Info -->
        <div class="flex flex-wrap items-center justify-center gap-6 text-slate-400 mb-8 animate-meta opacity-0">
            <div class="flex items-center">
                <i class="fas fa-calendar mr-2"></i>
                {{ post.created_at|date:"d F Y" }}
            </div>
            <div class="flex items-center">
                <i class="fas fa-user mr-2"></i>
                {{ author_name }}
            </div>
            {% if post.updated_at != post.created_at %}
                <div class="flex items-center">
                    <i class="fas fa-edit mr-2"></i>
                    Modifié le {{ post.updated_at|date:"d F Y" }}
                </div>
            {% endif %}
        </div>

        <!-- Introduction -->
        {% if post.introduction %}
            <p class="text-lg md:text-xl text-slate-300 text-center max-w-3xl leading-relaxed animate-intro opacity-0">
                {{ post.introduction }}
            </p>
        {% endif %}
    </div>
</section>

<!-- ARTICLE CONTENT -->
<section class="py-12 bg-slate-800 relative">
    <div class="container mx-auto px-4 relative z-10">
        <div class="max-w-4xl mx-auto">
            
            <!-- Thumbnail -->
            {% if post.thumbnail %}
                <div class="mb-8 rounded-2xl overflow-hidden shadow-2xl">
                    <img src="{{ post.thumbnail.url }}" 
                         alt="{{ post.thumbnail_caption|default:post.title }}"
                         class="w-full h-64 md:h-96 object-cover">
                    {% if post.thumbnail_caption %}
                        <div class="bg-slate-700/50 backdrop-blur-sm p-4 text-center">
                            <p class="text-slate-300 text-sm italic">{{ post.thumbnail_caption }}</p>
                        </div>
                    {% endif %}
                </div>
            {% endif %}

            <!-- Article Content -->
            <article class="prose prose-lg prose-slate prose-invert max-w-none">
                <div class="bg-slate-700/30 backdrop-blur-sm rounded-2xl p-8 border border-slate-600/50">
                    {{ post.content|safe }}
                </div>
            </article>

            <!-- Article Footer -->
            <div class="mt-12 pt-8 border-t border-slate-600/50">
                <div class="flex flex-wrap items-center justify-between gap-4">
                    <!-- Tags/Keywords -->
                    {% if post.keywords %}
                        <div class="flex flex-wrap gap-2">
                            <span class="text-slate-400 text-sm">Mots-clés :</span>
                            {% for keyword in post.keywords|split:',' %}
                                <span class="bg-slate-600/50 text-slate-300 px-3 py-1 rounded-full text-sm">
                                    {{ keyword }}
                                </span>
                            {% endfor %}
                        </div>
                    {% endif %}

                    <!-- Share Buttons -->
                    <div class="flex items-center gap-3">
                        <span class="text-slate-400 text-sm">Partager :</span>
                        <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri|urlencode }}" 
                           target="_blank" rel="noopener"
                           class="w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center hover:bg-blue-500 transition-colors">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="https://twitter.com/intent/tweet?url={{ request.build_absolute_uri|urlencode }}&text={{ post.title|urlencode }}" 
                           target="_blank" rel="noopener"
                           class="w-10 h-10 bg-cyan-500 text-white rounded-full flex items-center justify-center hover:bg-cyan-400 transition-colors">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ request.build_absolute_uri|urlencode }}" 
                           target="_blank" rel="noopener"
                           class="w-10 h-10 bg-blue-700 text-white rounded-full flex items-center justify-center hover:bg-blue-600 transition-colors">
                            <i class="fab fa-linkedin-in"></i>
                        </a>
                        <button onclick="copyToClipboard('{{ request.build_absolute_uri }}')" 
                                class="w-10 h-10 bg-slate-600 text-white rounded-full flex items-center justify-center hover:bg-slate-500 transition-colors">
                            <i class="fas fa-link"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- RELATED ARTICLES -->
{% if related_articles %}
<section class="py-12 bg-slate-900 relative overflow-hidden">
    <div class="container mx-auto px-4 relative z-10">
        <div class="max-w-7xl mx-auto">
            
            <!-- Section Header -->
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-bold text-white mb-4">
                    Articles <span class="bg-gradient-to-r from-cyan-400 to-blue-500 bg-clip-text text-transparent">Similaires</span>
                </h2>
                <p class="text-slate-400 text-lg">Découvrez d'autres articles qui pourraient vous intéresser</p>
            </div>

            <!-- Related Articles Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                {% for article in related_articles %}
                    <article class="group bg-slate-800/50 backdrop-blur-sm rounded-2xl overflow-hidden shadow-lg hover:shadow-2xl 
                    transition-all duration-500 transform hover:-translate-y-2 border border-slate-700/50">
                        
                        <!-- Image -->
                        {% if article.thumbnail %}
                            <div class="h-48 overflow-hidden relative">
                                <img src="{{ article.thumbnail.url }}" 
                                     alt="{{ article.thumbnail_caption|default:article.title }}"
                                     class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500">
                                <div class="absolute inset-0 bg-gradient-to-t from-slate-900/50 to-transparent"></div>
                                
                                <!-- Categories overlay -->
                                {% if article.categories.all %}
                                    <div class="absolute top-3 left-3 flex flex-wrap gap-1">
                                        {% for category in article.categories.all %}
                                            <span class="bg-orange-500/90 text-white text-xs px-2 py-1 rounded-full font-medium backdrop-blur-sm">
                                                {{ category.name }}
                                            </span>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        {% else %}
                            <!-- Placeholder -->
                            <div class="h-48 bg-gradient-to-br from-cyan-500/20 to-blue-600/20 flex items-center justify-center relative">
                                <i class="fas fa-newspaper text-3xl text-slate-400"></i>
                                {% if article.categories.all %}
                                    <div class="absolute top-3 left-3 flex flex-wrap gap-1">
                                        {% for category in article.categories.all %}
                                            <span class="bg-orange-500/90 text-white text-xs px-2 py-1 rounded-full font-medium backdrop-blur-sm">
                                                {{ category.name }}
                                            </span>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        {% endif %}
                        
                        <!-- Content -->
                        <div class="p-6">
                            <!-- Date -->
                            <div class="text-sm text-slate-400 mb-3 flex items-center">
                                <i class="fas fa-calendar mr-2"></i>
                                {{ article.created_at|date:"d F Y" }}
                            </div>
                            
                            <!-- Title -->
                            <h3 class="text-lg font-bold text-white mb-3 group-hover:text-cyan-400 transition-colors duration-300 line-clamp-2">
                                <a href="{% url 'blog:article_detail' article.slug %}">{{ article.title }}</a>
                            </h3>
                            
                            <!-- Introduction -->
                            <p class="text-slate-300 mb-4 line-clamp-2 leading-relaxed text-sm">
                                {{ article.introduction }}
                            </p>
                            
                            <!-- Read More -->
                            <div class="pt-3 border-t border-slate-700/50">
                                <a href="{% url 'blog:article_detail' article.slug %}" 
                                   class="inline-flex items-center text-cyan-400 font-medium group-hover:text-cyan-300 transition-colors duration-300 text-sm">
                                    Lire l'article
                                    <i class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform duration-300"></i>
                                </a>
                            </div>
                        </div>
                    </article>
                {% endfor %}
            </div>

            <!-- CTA -->
            <div class="text-center mt-12">
                <a href="{% url 'blog:index' %}" 
                   class="inline-flex items-center bg-gradient-to-r from-cyan-500 to-blue-600 text-white px-8 py-4 rounded-xl hover:from-cyan-400 hover:to-blue-500 transition-all duration-300 font-semibold">
                    <i class="fas fa-newspaper mr-2"></i>
                    Voir tous les articles
                </a>
            </div>
        </div>
    </div>
</section>
{% endif %}

<!-- NAVIGATION -->
<section class="py-8 bg-slate-800 border-t border-slate-700/50">
    <div class="container mx-auto px-4">
        <div class="max-w-4xl mx-auto">
            <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
                <!-- Back to Blog -->
                <a href="{% url 'blog:index' %}" 
                   class="inline-flex items-center text-slate-300 hover:text-cyan-400 transition-colors">
                    <i class="fas fa-arrow-left mr-2"></i>
                    Retour au blog
                </a>
                
                <!-- Home -->
                <a href="{% url 'main:index' %}" 
                   class="inline-flex items-center text-slate-300 hover:text-orange-400 transition-colors">
                    <i class="fas fa-home mr-2"></i>
                    Accueil
                </a>
            </div>
        </div>
    </div>
</section>

{% endblock %}

{% block scripts %}
<style>
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    
    /* Styles pour le contenu de l'article */
    .prose {
        color: #e2e8f0;
    }
    
    .prose h1, .prose h2, .prose h3, .prose h4, .prose h5, .prose h6 {
        color: #f1f5f9;
        font-weight: 700;
    }
    
    .prose h2 {
        font-size: 1.875rem;
        margin-top: 2rem;
        margin-bottom: 1rem;
    }
    
    .prose h3 {
        font-size: 1.5rem;
        margin-top: 1.5rem;
        margin-bottom: 0.75rem;
    }
    
    .prose p {
        margin-bottom: 1.25rem;
        line-height: 1.75;
    }
    
    .prose ul, .prose ol {
        margin-bottom: 1.25rem;
        padding-left: 1.5rem;
    }
    
    .prose li {
        margin-bottom: 0.5rem;
    }
    
    .prose blockquote {
        border-left: 4px solid #0ea5e9;
        padding-left: 1rem;
        margin: 1.5rem 0;
        font-style: italic;
        color: #94a3b8;
    }
    
    .prose code {
        background-color: #1e293b;
        color: #0ea5e9;
        padding: 0.25rem 0.5rem;
        border-radius: 0.375rem;
        font-size: 0.875rem;
    }
    
    .prose pre {
        background-color: #1e293b;
        color: #e2e8f0;
        padding: 1rem;
        border-radius: 0.5rem;
        overflow-x: auto;
        margin: 1.5rem 0;
    }
    
    .prose img {
        border-radius: 0.5rem;
        margin: 1.5rem 0;
    }
    
    .prose a {
        color: #0ea5e9;
        text-decoration: none;
    }
    
    .prose a:hover {
        color: #38bdf8;
        text-decoration: underline;
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Animations d'entrée
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, observerOptions);

    // Observer les éléments à animer
    document.querySelectorAll('.animate-breadcrumb, .animate-categories, .animate-title, .animate-meta, .animate-intro').forEach(el => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(20px)';
        el.style.transition = 'opacity 0.6s ease-out, transform 0.6s ease-out';
        observer.observe(el);
    });

    // Animation séquentielle
    setTimeout(() => {
        const elements = document.querySelectorAll('.animate-breadcrumb, .animate-categories, .animate-title, .animate-meta, .animate-intro');
        elements.forEach((el, index) => {
            setTimeout(() => {
                el.style.opacity = '1';
                el.style.transform = 'translateY(0)';
            }, index * 200);
        });
    }, 300);

    // Fonction pour copier le lien
    window.copyToClipboard = function(text) {
        navigator.clipboard.writeText(text).then(function() {
            // Afficher une notification
            const button = event.target.closest('button');
            const originalIcon = button.innerHTML;
            button.innerHTML = '<i class="fas fa-check"></i>';
            button.classList.add('bg-green-600', 'hover:bg-green-500');
            button.classList.remove('bg-slate-600', 'hover:bg-slate-500');
            
            setTimeout(() => {
                button.innerHTML = originalIcon;
                button.classList.remove('bg-green-600', 'hover:bg-green-500');
                button.classList.add('bg-slate-600', 'hover:bg-slate-500');
            }, 2000);
        });
    };
});
</script>
{% endblock %}